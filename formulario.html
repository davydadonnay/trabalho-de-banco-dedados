<?php 
session_start();
?>
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulário - Sistema</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container py-5">
    <div class="card mx-auto formulario-bootstrap">
      <div class="card-body">
        <h2 class="card-title text-center mb-4" id="form-title">Formulário de Cadastro</h2>

        <form action="create.php" method="POST" id="formCadastro" novalidate>
          <input type="hidden" id="id" name="id" value="">

          <div class="mb-3">
            <label for="nomeCompleto" class="form-label">Nome completo:</label>
            <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite seu nome completo" required>
          </div>

          <div class="mb-3">
            <label for="dataNascimento" class="form-label">Data de nascimento:</label>
            <input type="date" class="form-control" id="dataNascimento" name="dataNasc" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Endereço:</label>
            <div class="mb-2">
              <input type="text" class="form-control" id="enderecoRua" name="rua" placeholder="Rua" required>
            </div>

            <div class="row g-2">
              <div class="col-4">
                <input type="text" class="form-control" id="enderecoNumero" name="numero" placeholder="Número" required>
              </div>
              <div class="col-4">
                <input type="text" class="form-control" id="enderecoBairro" name="bairro" placeholder="Bairro" required>
              </div>
              <div class="col-4">
                <input type="text" class="form-control" id="enderecoCEP" name="cep" placeholder="CEP" required>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="responsavel" class="form-label">Nome do responsável:</label>
            <input type="text" class="form-control" id="responsavel" name="responsavel" placeholder="Digite o nome do responsável">
          </div>

          <div class="mb-3">
            <label for="tipo" class="form-label">Tipo:</label>
            <select id="tipo" name="tipo" class="form-select" required>
              <option value="" selected disabled>Selecione...</option>
              <option value="Aluno">Aluno</option>
              <option value="Responsavel">Responsável</option>
              <option value="Outro">Outro</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="curso" class="form-label">Curso:</label>
            <select id="curso" name="curso" class="form-select" required>
              <option value="" selected disabled>Selecione o curso...</option>
              <option>Desenvolvimento de Sistemas</option>
              <option>Informática</option>
              <option>Administração</option>
              <option>Enfermagem</option>
            </select>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-4">
            <a href="dashboard.html" class="btn btn-outline-secondary">Voltar ao Dashboard</a>
            <button type="submit" class="btn btn-success" id="btnEnviar">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('formCadastro');

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(form);
    const id = formData.get('id');
    const url = id ? 'update.php' : 'create.php';

    fetch(url, {
      method: 'POST',
      body: formData
    })
    .then(r => r.json())
    .then(resp => {
      if (resp.status === 'ok') {
        alert('Cadastro realizado com sucesso!');
        window.location.href = 'dashboard.php';
      } else {
        alert('Erro: ' + (resp.message || JSON.stringify(resp)));
      }
    })
    .catch(err => {
      console.error(err);
      alert('Erro na requisição.');
    });
  });

});
</script>
</body>
</html>
